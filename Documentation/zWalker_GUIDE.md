# zWalker Guide

## Introduction

**zWalker relies on UI `zVaFiles`** which are defined and configured and fired via `$ zolo-zcli --shell` or a `zSpark` object in Python or Javascript scripts. These specialized UI files contain the navigation structure, menus, that power zWalker's interactive experiences.

> **Note:** When using `$ zolo-zcli --shell`, manual configuration of a `zWalker` `zSession` is required - see [zShell_GUIDE.md](/Documentation/zShell_GUIDE.md) for details.

### zSpark

`zSpark` is the configuration object that acts as the **single source of truth** for zWalker, similar to an .env file. It contains all the settings needed to initialize and run the UI system.

### Example zSpark Configuration:
```python
zSpark_config = {
    "zSpark": "zCLI UI Manual", #label
    "zVaFile": "ui.manual.yaml",
    "zWorkspace": "/Users/galnachshon/Projects/zolo-zcli", 
    "zVaFile_path": "@",
    "zVaFilename": "ui.manual",
    "zBlock": "Root",
    "zMode": "Terminal"
}
```

When zWalker starts, it populates the zSession with the configurations from `zSpark_obj`:
- `zSession_ID` - Unique zSession id generated by zolo-zcli.utils
- `zWorkspace` - Project workspace path
- `zVaFile_path` - UI file path (defaults to "@" if left blank)
- `zVaFilename` - Current UI file name
- `zBlock` - Starting block in UI file
- `zMode` - "Terminal" or "zGUI"

> **Note:** For **zolo-zcli** `zPath` documentation, see: [zParser_GUIDE.md](/Documentation/zParser_GUIDE.md)

## zPath Resolution

**zolo-zcli** uses a special `zPath` syntax for referencing files and functions across a system. Paths are resolved using `zParser` to support zWorkspace-relative and absolute paths.

### Path Symbols:

- `@` - **Workspace-relative path** (relative to zWorkspace)
- `~` - **Absolute path** (from filesystem root)
- No symbol - **System-dependent** (behavior varies by subsystem) `#WIP`

### UI Path Structure:

**Example:**
- OS file: `/Users/galnachshon/Projects/Zolo/ui.zolo.yaml`
- zWorkspace: `/Users/galnachshon/Projects`
- zPath: `@.Zolo.ui.zolo.zBlock`

### Other Path Structures:

**Schema files (zSchema) - MUST start with "schema.":**

**Example:**
- OS file: `/Users/galnachshon/Projects/Zolo/schema.users.yaml`
- zWorkspace: `/Users/galnachshon/Projects`
- zPath: `@.Zolo.schema.users.Users`

**Python functions (zFunc):**

**Example:**
- OS file: `/Users/galnachshon/Projects/Zolo/utils/helpers.py`
- zWorkspace: `/Users/galnachshon/Projects`
- zPath: `@.Zolo.utils.helpers.generate_id`

>**Note:** For **zolo-zcli** `zPath` documentation: see [zParser_GUIDE.md](/Documentation/zParser_GUIDE.md)

## zWalker Mechanism

### Vertical Walk (`zBlocks`)

The vertical walk is zWalker's **core navigation mechanism**. It processes each `zKey`, in a top-to-bottom sequence, within a given `zBlock`:

1. **Load zBlock**: using `zLoader`, the `zWalker` loads a `zBlock` from a YAML file (e.g., "ui.manual.yaml")
2. **Extract zKeys**: using 'zParser', the `zWalker` extracts `zKeys` from the `zBlock` dictionary
3. **Iterate Vertically**: Loops through each `zKey` in order:
   - Updates breadcrumb trail for navigation history
   - Displays/executes the current `zKey` being processed (`zMenu`, `zFunc`, `zDialog`, etc..)

> **Note:** For **zolo-zcli** `zCrumbs` documentation, see: [zCrumbs_GUIDE.md](/Documentation/zCrumbs_GUIDE.md)

### Horizontal Walk (`zKeys`)

A `zBlock` is composed of a dict of zKeys. **Each `zKey` is a customizable menu option, value, or action within a zBlock** that defines what happens when it is processed by `zDispatch`

>**Note:** For **zolo-zcli** `zDispatch` documentation: see [zDispatch_GUIDE.md](/Documentation/zDispatch_GUIDE.md)

## zKey Modifiers

`zKeys` use prefix and suffix modifiers to control their behavior:

### Prefix Modifiers:
- `^` - Execute and return
- `~` - Anchor mode (no "zBack" option in menus)
- `$` - Delta link (switch between zBlocks in same UI file)

### Suffix Modifiers:
- `*` - Display as interactive menu
- `!` - Required field (for forms/dialogs)

>**Note:** For **zolo-zcli** `Modifiers` documentation: see [zDispatch_GUIDE.md](/Documentation/zDispatch_GUIDE.md)

## zKey types

#### zMenu (Interactive Menus)
When a `zKey` has the `*` suffix modifier, zMenu creates an interactive numbered menu:

**Requirements:**
- Menu items must be defined as an array `["item1", "item2", "item3"]`
- Item values must exactly match (including modifiers) the `zKeys` they are targeting within the same `zBlock`
- "zBack" option is added automatically (unless modified as anchor mode by adding a `~` prefix)
- Use `$` prefix in menu items for delta links (same-file block navigation)

Example:
```yaml
zVaF:
  ~Root*: ["one", "~two*", "^three", "$Settings"]
    one: "zFunc(@.some.function)"
    ~two*: ["option1", "option2"]
    ^three: "zFunc(@.another.function)"
    $Settings: # Delta link to Settings block in same file
      # Settings block content here
```

>**Note:** For **zolo-zcli** `zMenu` documentation: see [zMenu_GUIDE.md](/Documentation/zMenu_GUIDE.md)

### zFunc

`zFunc` executes functions directly within a `zKey`. It's used for calling specific functions without user interaction and often used with an auto-back (`zBounce`) prefix modifier of `^`.

**Syntax:**
```yaml
^zFunc_Example: "zFunc(@.path.to.file.function_name, args)"
```

**Syntax definitions:**
- `zFunc`: **zolo-zcli** command to dispatch a zFunc
- `@`: relative path to workspace, otherwise considered as absolute path
- `function_name`: the name of the `def` from the python file 
- `args`: comma-separated arguments (can include zContext, this.field, or literal values)

>**Note:** For **zolo-zcli** `zFunc` documentation: see [zFunc_GUIDE.md](/Documentation/zFunc_GUIDE.md)

### zLink (Inter-file Navigation)

`zLink` navigates to other UI zVaFiles within the zWalker's zWorkspace or outside of it.

**Syntax:**
```yaml
zKey_example: "zLink(@.path.to.filename.block_name)"
```

**Syntax definitions:**
- `zLink`: **zolo-zcli** command to navigate to another UI `zVaFile`
- `@`: workspace-relative path (as defined in zPath Resolution)
- `path.to.filename`: dotted path to the YAML file (without .yaml extension)
- **UI files MUST start with "ui."** (e.g., `ui.zolo`, `ui.manual`)
- `block_name`: specific block within the target file to navigate to

**Examples:**
```yaml
# OS file: /Users/galnachshon/Projects/Zolo/ui.zolo.yaml
# zWorkspace: /Users/galnachshon/Projects
# zPath: @.Zolo.ui.zolo.Main
"zLink(@.Zolo.ui.zolo.Main)"

# OS file: /Users/galnachshon/Projects/Zolo/ui.manual.yaml
# zWorkspace: /Users/galnachshon/Projects
# zPath: @.Zolo.ui.manual.Root
"zLink(@.Zolo.ui.manual.Root)"
```

**Optional Permissions:**
```yaml
zKey_example: "zLink(@.path.to.file.block_name, {permission_key: required_value})"
```

**Key Points:**
- Updates zSession with new file path, filename, and block
- Automatically manages breadcrumb navigation
- Supports permission-based access control
- Returns control to continue vertical walk after navigation

>**Note:** For **zolo-zcli** `zLink` documentation: see [zLink_GUIDE.md](/Documentation/zLink_GUIDE.md)

### zDialog (Interactive Forms)

`zDialog` creates interactive forms for **user input collection and data manipulation**. It handles form rendering, field validation, and submission processing.

**Syntax:**
```yaml
zKey_example:
  zDialog:
    model: "zPath.to.shema.zVaFile"
    fields: ["field1", "field2", "field3"]
    onSubmit: "zFunc(zPath.to.file.function_name, zConv)"
```

**Syntax definitions:**
- `zDialog`: **zolo-zcli** command to create interactive form
- `model`: **zPath to schema zVaFile** for form validation and data structure
- `fields`: Array of field names to collect from user
- `onSubmit`: Function to execute when form is submitted (receives `zConv` data)

**Schema Integration:**
zDialog uses schema zVaFiles (e.g., `@.schema.users.Users`) to:
- **Validate input**: Field types, constraints, and requirements
- **Structure data**: Ensure collected data matches schema format
- **Enable CRUD operations**: Collected data can be used with zCRUD for database operations

**Key Points:**
- Collects user input through interactive prompts
- Validates input based on field types and model schema
- Passes collected data (`zConv`) to onSubmit function
- Supports string, enum, and other input types
- Automatically handles form submission flow

>**Note:** For **zolo-zcli** `zDialog` documentation: see [zDialog_GUIDE.md](/Documentation/zDialog_GUIDE.md)

### zWizard (Multi-step Workflows)

`zWizard` executes a sequence of steps in order, storing results in `zHat` for use in subsequent steps. It enables complex multi-step workflows and data passing between steps.

**Syntax:**
```yaml
zKey_example:
  zWizard:
    stepOne: "zFunc(@.path.to.file1.function_name)"
    stepTwo: "zFunc(@.path.to.file2.function_name)"
    stepThree: "zFunc(@.path.to.file3.function_name, {zHat[0], zHat[1]})"
```

**Syntax definitions:**
- `zWizard`: **zolo-zcli** command to create multi-step workflow
- `stepName`: Each step executes in order (stepOne, stepTwo, stepThree, etc.)
- `zHat[index]`: Access results from previous steps (zHat[0] = stepOne result, zHat[1] = stepTwo result)
- Each step can be any zKey type (zFunc, zDialog, zMenu, etc.)

**Key Points:**
- Executes steps sequentially from top to bottom
- Each step result is stored in `zHat` array at corresponding index
- Later steps can reference previous results using `zHat[index]`
- Steps can be any zKey type (zFunc, zDialog, zMenu, zLink)
- Returns final `zHat` array with all step results

>**Note:** For **zolo-zcli** `zWizard` documentation: see [zWizard_GUIDE.md](/Documentation/zWizard_GUIDE.md)

---

## Shell Integration

Walker can launch zShell mode for advanced operations, debugging, or direct command execution. This allows you to drop into Shell mode from a menu, execute commands, and return to the Walker interface.

**Function:** `zShell()`

Add a menu option to launch Shell:

```yaml
zVaF:
  MainMenu*: ["Database", "Settings", "^Launch Shell"]
    ^Launch Shell: "zShell()"
```

#### Important Notes

- Shell inherits the same session as Walker (same `zS_id`)
- Shell operates on the same `zWorkspace` and `zAuth` context
- All subsystems (CRUD, zFunc, zAuth) remain accessible
- Type `exit`, `quit`, or `q` to return to Walker
- Walker resumes exactly where it left off

>**Note:** For more information on Shell commands and usage, see [zShell_GUIDE.md](zShell_GUIDE.md)---

## Crash Recovery

### Built-in Safety Menu

Walker includes a built-in crash recovery system that prevents complete failure when errors occur during navigation.

**How it works:**

When an exception occurs during zKey dispatch (e.g., missing file, function error, parse error), Walker automatically:

1. **Catches the exception** and stores error details
2. **Displays crash notification** with error message
3. **Launches safety reboot menu** with three options:
   - **Restart Walker** - Restart from original zSpark configuration
   - **View Error** - Display full traceback for debugging
   - **Quit to Shell** - Return to Shell mode gracefully

**Example Crash Recovery Flow:**

```
User navigates to broken zKey
â†“
Exception occurs (e.g., file not found, function error)
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸  WALKER CRASH DETECTED                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Error: FileNotFoundError: ui.missing.yaml not found        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  [0] Restart Walker
  [1] View Error
  [2] Quit to Shell
Select an option by number: 1

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ðŸ” CRASH DETAILS                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Error: FileNotFoundError: ui.missing.yaml not found        â”‚
â”‚                                                            â”‚
â”‚ Traceback:                                                 â”‚
â”‚ File "zWalker.py", line 296, in zBlock_loop              â”‚
â”‚   result = self.dispatch.handle(zKey, zHorizontal)        â”‚
â”‚ ...                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Press Enter to return to reboot menu...
```

**Options:**

1. **Restart Walker** (`^Restart Walker`)
   - Clears crash context
   - Restarts from original zSpark configuration
   - Reloads UI file from session
   - Returns to starting zBlock
   - Useful for transient errors or after fixing issues

2. **View Error** (`^View Error`)
   - Displays complete traceback
   - Shows error message details
   - Pauses for review
   - Returns to reboot menu
   - Useful for debugging

3. **Quit to Shell** (`Quit to Shell`)
   - Returns to Shell mode gracefully
   - Preserves session state
   - No data loss
   - Can run `walker run` again to retry
   - Useful when error requires code changes

**Key Features:**

- âœ… **No process crash** - Shell remains active
- âœ… **Session preserved** - Same zS_id, zAuth, zWorkspace
- âœ… **Built-in menu** - Uses existing menu system, no external file needed
- âœ… **Full diagnostics** - Complete traceback available
- âœ… **Easy restart** - One-click return to working state
- âœ… **Graceful exit** - Clean return to Shell for debugging

**When Crashes Are Caught:**

- File not found errors
- Function execution failures
- Parse errors in UI files
- Missing schema or model files
- Permission errors
- Any unexpected exception during zKey dispatch

**When Crashes Are NOT Caught:**

- Errors during Walker initialization (`run()` method before loop starts)
- Python syntax errors in UI YAML files
- Critical system errors (memory, disk full)
- Keyboard interrupts (Ctrl+C) - handled separately

> **Note:** Crash recovery is only available when running Walker from Shell via `walker run` command. Standalone Walker mode will still exit on crashes.

