<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    {% if title %}
        <title>zBlog - {{ title }}</title>
    {% else %}
        <title>zBlog</title>
    {% endif %}
    
    <!-- Bootstrap CSS (matching Corey Schafer's Flask tutorial) -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    
    <!-- Test: Flask-like /static/* convention -->
    <script src="/static/js/hello.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">zBlog</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about">About</a>
                    </li>
                </ul>
                <!-- Connection Status -->
                <span class="navbar-text">
                    <span id="connection-status" class="badge badge-secondary">Connecting...</span>
                </span>
            </div>
        </div>
    </nav>
    
    <main class="container mt-4">
        <div class="row">
            <!-- Main Content Zone -->
            <div class="col-md-8">
                <div id="zui-content">
                    {% block content %}{% endblock %}
                </div>
            </div>
            
            <!-- Sidebar Zone -->
            <div class="col-md-4">
                <div id="zui-sidebar">
                    <!-- Sidebar content will be rendered here via zDisplay events -->
                </div>
            </div>
        </div>
    </main>
    
    <!-- BifrostClient from jsDelivr CDN (using specific commit hash) -->
    <!-- Using commit hash for immediate availability (no cache delay) -->
    <script src="https://cdn.jsdelivr.net/gh/ZoloAi/zolo-zcli@f86b2abd9cab149a6163de826e4b27b90afbdc7f/zCLI/subsystems/zComm/zComm_modules/bifrost/client/src/bifrost_client.js" 
            crossorigin="anonymous"></script>
    
    <!-- TODO: Publish to npm for cleaner import like: -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/@zoloai/zcli@1.5.5/bifrost_client.min.js"></script> -->
    
    <!-- WebSocket Connection Script -->
    <script>
        console.log('Level 4a: Multi-Zone Layout');
        console.log('BifrostClient available?', typeof BifrostClient !== 'undefined');
        
        // Check if BifrostClient is defined before proceeding
        if (typeof BifrostClient === 'undefined') {
            console.error('‚ùå BifrostClient is not defined! Script may have failed to load or execute.');
            console.error('Check browser console for script loading errors.');
            document.getElementById('connection-status').className = 'badge badge-danger';
            document.getElementById('connection-status').textContent = '‚óè Script Load Failed';
            throw new Error('BifrostClient not available');
        }
        
        console.log('Initializing BifrostClient...');
        
        // Get connection status badge
        const statusBadge = document.getElementById('connection-status');
        
        // Update status badge
        function updateStatus(status, text) {
            statusBadge.className = `badge badge-${status}`;
            statusBadge.textContent = text;
        }
        
        // Initialize BifrostClient and connect to zBifrost server
        const client = new BifrostClient('ws://127.0.0.1:8765', {
            debug: true,
            autoTheme: false,  // Using Bootstrap, not zTheme
            hooks: {
                onConnected: (info) => {
                    console.log('‚úÖ Connected to zBifrost server', info);
                    updateStatus('success', '‚óè Connected');
                },
                onDisconnected: (reason) => {
                    console.log('‚ùå Disconnected from zBifrost server', reason);
                    updateStatus('danger', '‚óè Disconnected');
                },
                onDisplay: (event) => {
                    console.log('üì® Received zDisplay event:', event);
                    // zDisplay events will be auto-rendered by BifrostClient's default handler
                    // (Level 4b will send actual zDisplay events from backend)
                },
                onError: (error) => {
                    console.error('‚ö†Ô∏è WebSocket error:', error);
                    updateStatus('warning', '‚óè Connection Error');
                }
            }
        });
        
        // Connect on page load
        console.log('Connecting to WebSocket server...');
        client.connect().catch(error => {
            console.error('Failed to connect:', error);
            updateStatus('danger', '‚óè Connection Failed');
        });
    </script>
</body>
</html>

