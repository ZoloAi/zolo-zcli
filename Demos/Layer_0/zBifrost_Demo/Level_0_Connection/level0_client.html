<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Level 0: Hello zBlog</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>ğŸŒ‰ Level 0: Hello zBlog</h1>
        <p class="subtitle">Your first WebSocket connection!</p>
        
        <div class="goal">
            <strong>ğŸ¯ Goal:</strong> Connect to the zBlog server and see a welcome message. That's it!
        </div>
        
        <div id="status" class="status disconnected">
            âŒ Not Connected
        </div>
        
        <div id="messageBox" class="message-box">
            Waiting for connection...
        </div>
        
        <div class="buttons">
            <button id="connectBtn" class="btn-connect" onclick="connect()">
                ğŸš€ Connect to Server
            </button>
            <button id="disconnectBtn" class="btn-disconnect" onclick="disconnect()" disabled>
                ğŸ‘‹ Disconnect
            </button>
        </div>
        
        <div class="instructions">
            <h3>ğŸ“‹ Instructions</h3>
            <ol>
                <li>Make sure <code>level0_backend.py</code> is running</li>
                <li>Click the "Connect to Server" button above</li>
                <li>You should see a welcome message from zBlog!</li>
                <li>Click "Disconnect" when done</li>
            </ol>
        </div>
    </div>

    <script>
        // Simple WebSocket client for Level 0
        // No fancy libraries, just pure JavaScript!
        
        let ws = null;
        const statusDiv = document.getElementById('status');
        const messageBox = document.getElementById('messageBox');
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        
        function connect() {
            console.log('ğŸš€ Connecting to zBlog server...');
            
            // Create WebSocket connection
            ws = new WebSocket('ws://127.0.0.1:8765');
            
            // When connection opens
            ws.onopen = () => {
                console.log('âœ… Connected!');
                statusDiv.className = 'status connected';
                statusDiv.textContent = 'âœ… Connected to zBlog!';
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
            };
            
            // When we receive a message
            ws.onmessage = (event) => {
                console.log('ğŸ“¨ Message received:', event.data);
                
                try {
                    const msg = JSON.parse(event.data);
                    console.log('ğŸ“¦ Parsed message:', msg);
                    
                    // Check for connection_info (zBifrost sends this automatically)
                    if (msg.event === 'connection_info') {
                        showWelcomeMessage();
                    }
                    // Check for any other messages
                    else if (msg.message) {
                        showMessage(msg.message);
                    }
                } catch (e) {
                    // If it's not JSON, just show it as text
                    showMessage(event.data);
                }
            };
            
            // If connection fails
            ws.onerror = (error) => {
                console.error('âŒ Connection error:', error);
                showMessage('âŒ Connection failed! Is the server running?');
            };
            
            // When connection closes
            ws.onclose = () => {
                console.log('ğŸ‘‹ Disconnected');
                statusDiv.className = 'status disconnected';
                statusDiv.textContent = 'âŒ Not Connected';
                messageBox.className = 'message-box';
                messageBox.textContent = 'Waiting for connection...';
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
                ws = null;
            };
        }
        
        function disconnect() {
            if (ws) {
                console.log('ğŸ‘‹ Disconnecting...');
                ws.close();
            }
        }
        
        function showWelcomeMessage() {
            messageBox.className = 'message-box has-message';
            messageBox.innerHTML = `
                <div>
                    <div class="success-icon">ğŸ‰</div>
                    <div><strong>Hello from zBlog!</strong></div>
                    <div style="margin-top: 10px; font-size: 0.9em;">
                        You're connected and ready to build your blog!
                    </div>
                </div>
            `;
        }
        
        function showMessage(text) {
            messageBox.className = 'message-box has-message';
            messageBox.textContent = text;
        }
        
        // Log to console when page loads
        console.log('ğŸ‘‹ Level 0: Hello zBlog');
        console.log('ğŸ“ Click "Connect to Server" to start!');
    </script>
</body>
</html>
