<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Utils Quick Test</title>
  <style>
    body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
    .test { margin: 10px 0; padding: 10px; border-left: 3px solid #666; }
    .pass { border-left-color: #4ec9b0; background: #1e3a2e; }
    .fail { border-left-color: #f48771; background: #3a1e1e; }
    h1 { color: #4ec9b0; }
    h2 { color: #dcdcaa; }
  </style>
</head>
<body>
  <h1>üß™ Layer 2 Utilities - Quick Validation</h1>
  <div id="results"></div>

  <script type="module">
    import { 
      createElement, 
      appendChildren, 
      safeQuery,
      toggleClasses 
    } from '../src/utils/dom_utils.js';
    
    import { 
      getButtonColorClass, 
      getButtonSizeClass,
      getAlertColorClass,
      indentToHeaderTag 
    } from '../src/utils/ztheme_utils.js';
    
    import { 
      validateInput, 
      isValidEmail,
      parseMultiSelection 
    } from '../src/utils/validation_utils.js';

    const results = document.getElementById('results');
    let testsPassed = 0;
    let testsFailed = 0;

    function test(name, fn) {
      try {
        const result = fn();
        if (result) {
          results.innerHTML += `<div class="test pass">‚úÖ ${name}</div>`;
          testsPassed++;
        } else {
          results.innerHTML += `<div class="test fail">‚ùå ${name} - Returned false</div>`;
          testsFailed++;
        }
      } catch (error) {
        results.innerHTML += `<div class="test fail">‚ùå ${name} - ${error.message}</div>`;
        testsFailed++;
      }
    }

    // Test dom_utils
    results.innerHTML += '<h2>dom_utils.js</h2>';
    test('createElement creates button', () => {
      const btn = createElement('button', ['test-class'], { id: 'test-btn' });
      return btn.tagName === 'BUTTON' && btn.classList.contains('test-class') && btn.id === 'test-btn';
    });

    test('appendChildren adds multiple children', () => {
      const parent = createElement('div');
      const child1 = createElement('span');
      const child2 = createElement('span');
      appendChildren(parent, [child1, child2]);
      return parent.children.length === 2;
    });

    test('safeQuery returns null for invalid selector', () => {
      const result = safeQuery('#nonexistent-element-xyz');
      return result === null;
    });

    test('toggleClasses adds classes', () => {
      const el = createElement('div');
      toggleClasses(el, ['class1', 'class2'], true);
      return el.classList.contains('class1') && el.classList.contains('class2');
    });

    // Test ztheme_utils
    results.innerHTML += '<h2>ztheme_utils.js</h2>';
    test('getButtonColorClass maps primary', () => {
      return getButtonColorClass('primary') === 'zBtnPrimary';
    });

    test('getButtonColorClass is case-insensitive', () => {
      return getButtonColorClass('DANGER') === 'zBtnDanger';
    });

    test('getButtonSizeClass maps lg', () => {
      return getButtonSizeClass('lg') === 'zBtn-lg';
    });

    test('getButtonSizeClass returns empty for md', () => {
      return getButtonSizeClass('md') === '';
    });

    test('getAlertColorClass maps error to danger', () => {
      return getAlertColorClass('error') === 'zAlert zAlert-danger';
    });

    test('indentToHeaderTag converts 0 to h1', () => {
      return indentToHeaderTag(0) === 'h1';
    });

    test('indentToHeaderTag converts 2 to h3', () => {
      return indentToHeaderTag(2) === 'h3';
    });

    // Test validation_utils
    results.innerHTML += '<h2>validation_utils.js</h2>';
    test('validateInput accepts valid email', () => {
      const result = validateInput('test@example.com', 'email');
      return result.valid === true && result.error === null;
    });

    test('validateInput rejects invalid email', () => {
      const result = validateInput('notanemail', 'email');
      return result.valid === false && result.error !== null;
    });

    test('validateInput enforces required', () => {
      const result = validateInput('', 'string', { required: true });
      return result.valid === false;
    });

    test('validateInput enforces min length', () => {
      const result = validateInput('hi', 'string', { min: 5 });
      return result.valid === false;
    });

    test('isValidEmail validates correct email', () => {
      return isValidEmail('test@example.com') === true;
    });

    test('isValidEmail rejects invalid email', () => {
      return isValidEmail('invalid') === false;
    });

    test('parseMultiSelection parses "1,3,5"', () => {
      const result = parseMultiSelection('1,3,5');
      return result.length === 3 && result[0] === 1 && result[1] === 3 && result[2] === 5;
    });

    test('parseMultiSelection sorts and deduplicates', () => {
      const result = parseMultiSelection('5,1,3,1');
      return result.length === 3 && result[0] === 1 && result[1] === 3 && result[2] === 5;
    });

    // Summary
    results.innerHTML += `
      <h2>Summary</h2>
      <div class="test ${testsFailed === 0 ? 'pass' : 'fail'}">
        ‚úÖ Passed: ${testsPassed}<br>
        ${testsFailed > 0 ? `‚ùå Failed: ${testsFailed}<br>` : ''}
        <strong>${testsFailed === 0 ? 'üéâ ALL TESTS PASSED!' : '‚ö†Ô∏è Some tests failed'}</strong>
      </div>
    `;

    console.log(`Tests: ${testsPassed} passed, ${testsFailed} failed`);
  </script>
</body>
</html>

