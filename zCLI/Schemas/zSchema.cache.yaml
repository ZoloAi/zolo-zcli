# zSchema.cache.yaml - Cache Management Schema
# Defines data structure for managing all three cache tiers
# Enables CRUD operations and zDialog interfaces for cache inspection/management

# ═══════════════════════════════════════════════════════════
# Tier 1: Pinned Resources (User-Controlled)
# ═══════════════════════════════════════════════════════════
PinnedResources:
  id:
    type: int
    primary_key: true
    auto_increment: true
  
  key:
    type: str
    required: true
    unique: true
    description: "Cache key (e.g., 'parsed:/path/to/zUI.admin.yaml')"
  
  resource_type:
    type: str
    required: true
    options: ["ui", "schema", "config", "other"]
    description: "Type of resource (ui, schema, config, other)"
  
  filepath:
    type: str
    required: true
    description: "Full filesystem path to the resource"
  
  loaded_at:
    type: int
    required: true
    description: "Unix timestamp when resource was pinned"
  
  last_accessed:
    type: int
    description: "Unix timestamp of last access"
  
  access_count:
    type: int
    default: 0
    description: "Number of times accessed"
  
  size_bytes:
    type: int
    description: "Size of cached data in bytes"
  
  persistent:
    type: bool
    default: true
    description: "Should persist across sessions (saved to disk)"

# ═══════════════════════════════════════════════════════════
# Tier 2: Cached Files (Auto-Cached Navigation)
# ═══════════════════════════════════════════════════════════
CachedFiles:
  id:
    type: int
    primary_key: true
    auto_increment: true
  
  key:
    type: str
    required: true
    unique: true
    description: "Cache key for auto-cached file"
  
  namespace:
    type: str
    required: true
    default: "files"
    description: "Cache namespace (files, data, etc.)"
  
  filepath:
    type: str
    required: true
    description: "Full filesystem path"
  
  mtime:
    type: int
    description: "File modification time for freshness checking"
  
  cached_at:
    type: int
    required: true
    description: "Unix timestamp when cached"
  
  accessed_at:
    type: int
    description: "Unix timestamp of last access"
  
  hits:
    type: int
    default: 0
    description: "Number of cache hits"
  
  size_bytes:
    type: int
    description: "Size of cached data in bytes"

# ═══════════════════════════════════════════════════════════
# Tier 3: Schema Resources (Temporary CRUD)
# ═══════════════════════════════════════════════════════════
SchemaResources:
  id:
    type: int
    primary_key: true
    auto_increment: true
  
  key:
    type: str
    required: true
    unique: true
    description: "Schema cache key"
  
  schema_name:
    type: str
    required: true
    description: "Name of the schema (e.g., 'users', 'products')"
  
  filepath:
    type: str
    required: true
    description: "Full path to zSchema file"
  
  loaded_at:
    type: int
    required: true
    description: "Unix timestamp when loaded"
  
  crud_operation:
    type: str
    description: "CRUD operation that triggered load (read, create, update, delete)"
  
  auto_clear:
    type: bool
    default: true
    description: "Auto-clear after CRUD completes (false if manually pinned)"
  
  table_count:
    type: int
    description: "Number of tables in schema"
  
  field_count:
    type: int
    description: "Total number of fields across all tables"

# ═══════════════════════════════════════════════════════════
# Cache Statistics (Global Metrics)
# ═══════════════════════════════════════════════════════════
CacheStats:
  id:
    type: int
    primary_key: true
    auto_increment: true
  
  tier:
    type: str
    required: true
    options: ["pinned", "cached", "schemas"]
    description: "Cache tier name"
  
  total_items:
    type: int
    default: 0
    description: "Total items currently in tier"
  
  total_hits:
    type: int
    default: 0
    description: "Total cache hits"
  
  total_misses:
    type: int
    default: 0
    description: "Total cache misses"
  
  total_evictions:
    type: int
    default: 0
    description: "Total LRU evictions"
  
  total_invalidations:
    type: int
    default: 0
    description: "Total mtime invalidations"
  
  hit_rate:
    type: real
    description: "Cache hit rate percentage"
  
  max_size:
    type: int
    description: "Maximum allowed items"
  
  last_updated:
    type: int
    description: "Unix timestamp of last stat update"

# ═══════════════════════════════════════════════════════════
# Meta Configuration
# ═══════════════════════════════════════════════════════════
Meta:
  Data_Type: csv
  Data_path: ~.zMachine.Cache/cache.csv
